package com.alexsullivan.reddit.serialization

import com.google.gson.JsonParser
import org.junit.Assert
import org.junit.Test


class RedditResponseItemDeserializerTest {

    val selfPost by lazy {
        val string = """{"kind":"t3","data":{"contest_mode":false,"subreddit_name_prefixed":"r/GifRecipes","banned_by":null,"media_embed":{},"thumbnail_width":null,"subreddit":"GifRecipes","selftext_html":"&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;First of all, thank you to all of you who have contributed to this subreddit with your submissions and comments. Our community has just recently passed &lt;strong&gt;300,000 subscribers&lt;/strong&gt;(!), and that is thanks to all of you who have contributed quality content and constructive comments that make this subreddit consistently full of interesting and exciting gif recipes. &lt;/p&gt;\n\n&lt;p&gt;With reaching this milestone the mod team wants to make sure that we also have some clear and consistent community standards in place. We have updated the &lt;a href=\"https://www.reddit.com/r/GifRecipes/about/rules/\"&gt;subreddit rules&lt;/a&gt; to outline how we intend to continue fostering a community that encourages people to
        submit quality content, while combating spam, inappropriate content, and harassment. &lt;/p&gt;\n\n&lt;p&gt;We will also be starting a weekly thread on Mondays for people to post pictures of the recipes from this subreddit they have made, and any tips they have on how to improve upon recipes. I hope you will all try making something you see here and share a picture of the results in this week&amp;#39;s thread.&lt;/p&gt;\n\n&lt;p&gt;Finally, I want to add that the mods appreciate all your ideas and feedback. If you have any other suggestions for how we can improve upon this subreddit always feel free to send a message. It is all of you that have made this subreddit what it is today, and your contributions that will continue to grow our community well beyond this 300,000 subscriber milestone!&lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;","selftext":"First of all, thank you to all of you who have contributed to this subreddit with your submissions and comments. Our community has just recently passed **300,000 subscribers**(!),
        and that is thanks to all of you who have contributed quality content and constructive comments that make this subreddit consistently full of interesting and exciting gif recipes. \n\nWith reaching this milestone the mod team wants to make sure that we also have some clear and consistent community standards in place. We have updated the [subreddit rules](https://www.reddit.com/r/GifRecipes/about/rules/) to outline how we intend to continue fostering a community that encourages people to submit quality content, while combating spam, inappropriate content, and harassment. \n\nWe will also be starting a weekly thread on Mondays for people to post pictures of the recipes from this subreddit they have made, and any tips they have on how to improve upon recipes. I hope you will all try making something you see here and share a picture of the results in this week's thread.\n\nFinally,
        I want to add that the mods appreciate all your ideas and feedback. If you have any other suggestions for how we can improve upon this subreddit always feel free to send a message. It is all of you that have made this subreddit what it is today, and your contributions that will continue to grow our community well beyond this 300,000 subscriber milestone!","likes":null,"suggested_sort":null,"user_reports":[],"secure_media":null,"link_flair_text":null,"id":"5s58rb","view_count":null,"secure_media_embed":{},"clicked":false,"report_reasons":null,"author":"lnfinity","saved":false,"mod_reports":[],"name":"t3_5s58rb","score":333,"approved_by":null,"over_18":false,"domain":"self.GifRecipes","hidden":false,"thumbnail":"self","subreddit_id":"t5_3410y","edited":false,"link_flair_css_class":null,"author_flair_css_class":null,"gilded":0,"downs":0,"brand_safe":true,"archived":false,"removal_reason":null,
        "can_gild":false,"thumbnail_height":null,"hide_score":false,"spoiler":false,"permalink":"/r/GifRecipes/comments/5s58rb/community_guidelines/","num_reports":null,"locked":false,"stickied":true,"created":1486292450,"url":"https://www.reddit.com/r/GifRecipes/comments/5s58rb/community_guidelines/","author_flair_text":null,"quarantine":false,"title":"Community Guidelines","created_utc":1486263650,"distinguished":"moderator","media":null,"num_comments":65,"is_self":true,"visited":false,"subreddit_type":"public","ups":333}}"""
        JsonParser().parse(string)
    }

    val gfycatPost by lazy {
        val string = """{"kind":"t3","data":{"contest_mode":false,"subreddit_name_prefixed":"r/GifRecipes","banned_by":null,"media_embed":{"content":"&lt;iframe class=\"embedly-embed\" src=\"//cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fgfycat.com%2Fifr%2FContentEquatorialAlligatorgar&amp;url=https%3A%2F%2Fgfycat.com%2Fgifs%2Fdetail%2FContentEquatorialAlligatorgar&amp;image=https%3A%2F%2Fthumbs.gfycat.com%2FContentEquatorialAlligatorgar-size_restricted.gif&amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;type=text%2Fhtml&amp;schema=gfycat\" width=\"500\" height=\"500\" scrolling=\"no\" frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;","width":500,"scrolling":false,"height":500},"thumbnail_width":140,"subreddit":"GifRecipes","selftext_html":null,"selftext":"","likes":null,"suggested_sort":null,"user_reports":[],"secure_media":{"oembed":{"provider_url":"http://gfycat.com","description":"Watch this GIF on Gfycat. Discover more GIFS online on Gfycat","title":"Gfycat - Create, Discover and Share Awesome GIFs","type":"video","thumbnail_width":250,"height":500,"width":500,"html":"&lt;iframe class=\"embedly-embed\" src=\"https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fgfycat.com%2Fifr%2FContentEquatorialAlligatorgar&amp;url=https%3A%2F%2Fgfycat.com%2Fgifs%2Fdetail%2FContentEquatorialAlligatorgar&amp;image=https%3A%2F%2Fthumbs.gfycat.com%2FContentEquatorialAlligatorgar-size_restricted.gif&amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;type=text%2Fhtml&amp;schema=gfycat\" width=\"500\" height=\"500\" scrolling=\"no\" frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;","version":"1.0","provider_name":"gfycat","thumbnail_url":"https://i.embed.ly/1/image?url=https%3A%2F%2Fthumbs.gfycat.com%2FContentEquatorialAlligatorgar-size_restricted.gif&amp;key=b1e305db91cf4aa5a86b732cc9fffceb","thumbnail_height":250},"type":"gfycat.com"},"link_flair_text":null,"id":"6bcgyo","view_count":null,"secure_media_embed":{"content":"&lt;iframe class=\"embedly-embed\" src=\"https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fgfycat.com%2Fifr%2FContentEquatorialAlligatorgar&amp;url=https%3A%2F%2Fgfycat.com%2Fgifs%2Fdetail%2FContentEquatorialAlligatorgar&amp;image=https%3A%2F%2Fthumbs.gfycat.com%2FContentEquatorialAlligatorgar-size_restricted.gif&amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;type=text%2Fhtml&amp;schema=gfycat\" width=\"500\" height=\"500\" scrolling=\"no\" frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;","width":500,"scrolling":false,"height":500},"clicked":false,"report_reasons":null,"author":"kpthunder","saved":false,"mod_reports":[],"name":"t3_6bcgyo","score":1564,"approved_by":null,"over_18":false,"domain":"gfycat.com","hidden":false,"preview":{"images":[{"source":{"url":"https://i.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fm=jpg&amp;s=3a38d8f549ad93d5910a28179d7246f4","width":250,"height":250},"resolutions":[{"url":"https://i.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;fm=jpg&amp;s=59327c82ae244679e8251258ef54fd95","width":108,"height":108},{"url":"https://i.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;fm=jpg&amp;s=f8b05723d89b66db401faf3be960730a","width":216,"height":216}],"variants":{"gif":{"source":{"url":"https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?s=1b75201be0223b38cfe475bb8df43056","width":250,"height":250},"resolutions":[{"url":"https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;s=05a5cc71aae2278a4bd757f49769a031","width":108,"height":108},{"url":"https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;s=78db7eb337ec3b5e0a6c58525cb24ad8","width":216,"height":216}]},"mp4":{"source":{"url":"https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fm=mp4&amp;mp4-fragmented=false&amp;s=ce3a69e936733f03664485c7a3db0023","width":250,"height":250},"resolutions":[{"url":"https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;fm=mp4&amp;mp4-fragmented=false&amp;s=43012d6730e9324799204e1483f9570e","width":108,"height":108},{"url":"https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;fm=mp4&amp;mp4-fragmented=false&amp;s=b0a6aeee45a44963dc631531771c52eb","width":216,"height":216}]}},"id":"5MqnhMHe9srIiTxjDaCah4gX9KOHm5gbppBjQkNUvmM"}],"enabled":true},"thumbnail":"https://a.thumbs.redditmedia.com/3TS4j9FsQWYtl7IKy85BjbMHHFtA366udPOOLUxumK8.jpg","subreddit_id":"t5_3410y","edited":false,"link_flair_css_class":null,"author_flair_css_class":null,"gilded":0,"downs":0,"brand_safe":true,"archived":false,"removal_reason":null,"post_hint":"rich:video","can_gild":false,"thumbnail_height":140,"hide_score":false,"spoiler":false,"permalink":"/r/GifRecipes/comments/6bcgyo/mini_crème_brûlée_cheesecakes/","num_reports":null,"locked":false,"stickied":false,"created":1494904711,"url":"https://gfycat.com/ContentEquatorialAlligatorgar","author_flair_text":null,"quarantine":false,"title":"Mini Crème Brûlée Cheesecakes","created_utc":1494875911,"distinguished":null,"media":{"oembed":{"provider_url":"http://gfycat.com","description":"Watch this GIF on Gfycat. Discover more GIFS online on Gfycat","title":"Gfycat - Create, Discover and Share Awesome GIFs","type":"video","thumbnail_width":250,"height":500,"width":500,"html":"&lt;iframe class=\"embedly-embed\" src=\"//cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fgfycat.com%2Fifr%2FContentEquatorialAlligatorgar&amp;url=https%3A%2F%2Fgfycat.com%2Fgifs%2Fdetail%2FContentEquatorialAlligatorgar&amp;image=https%3A%2F%2Fthumbs.gfycat.com%2FContentEquatorialAlligatorgar-size_restricted.gif&amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;type=text%2Fhtml&amp;schema=gfycat\" width=\"500\" height=\"500\" scrolling=\"no\" frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;","version":"1.0","provider_name":"gfycat","thumbnail_url":"https://thumbs.gfycat.com/ContentEquatorialAlligatorgar-size_restricted.gif","thumbnail_height":250},"type":"gfycat.com"},"num_comments":43,"is_self":false,"visited":false,"subreddit_type":"public","ups":1564}}"""
        JsonParser().parse(string)
    }

    val imgurPost by lazy {
        val string = """{"kind":"t3","data":{"contest_mode":false,"subreddit_name_prefixed":"r/GifRecipes","banned_by":null,"media_embed":{},"thumbnail_width":140,"subreddit":"GifRecipes","selftext_html":null,"selftext":"","likes":null,"suggested_sort":null,"user_reports":[],"secure_media":null,"link_flair_text":null,"id":"6anl3c","view_count":null,"secure_media_embed":{},"clicked":false,"report_reasons":null,"author":"kickso","saved":false,"mod_reports":[],"name":"t3_6anl3c","score":1845,"approved_by":null,"over_18":false,"domain":"i.imgur.com","hidden":false,"preview":{"images":[{"source":{"url":"https://i.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fm=jpg&amp;s=16ec11f31c969a7c8970edb07b5cfa7a","width":600,"height":600},"resolutions":[{"url":"https://i.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;fm=jpg&amp;s=f30cc8b8f92196b567c7c2be16665196","width":108,"height":108},{"url":"https://i.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;fm=jpg&amp;s=654256293f1341c1ea0cb07cdd1d5181","width":216,"height":216},{"url":"https://i.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=320&amp;fm=jpg&amp;s=0896312debb74348fc9e0f7609b75b87","width":320,"height":320}],"variants":{"gif":{"source":{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?s=628cc5c99d5ebc429f59c9e3496cc15c","width":600,"height":600},"resolutions":[{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;s=96a696f2d317abda9c21c05994d6d22a","width":108,"height":108},{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;s=02ad38a7de2f87b99dff4fbee97f00cd","width":216,"height":216},{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=320&amp;s=13720066d50c092675d058de7d7483a8","width":320,"height":320}]},"mp4":{"source":{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fm=mp4&amp;mp4-fragmented=false&amp;s=9e4126fb9aef55d6f36f5963164db00d","width":600,"height":600},"resolutions":[{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;fm=mp4&amp;mp4-fragmented=false&amp;s=70ed79f9118994a8caabdcc0fdc78b91","width":108,"height":108},{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;fm=mp4&amp;mp4-fragmented=false&amp;s=a13ddd73bc5dba5dc87cd8f1101e8f79","width":216,"height":216},{"url":"https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=320&amp;fm=mp4&amp;mp4-fragmented=false&amp;s=a762aececacd9fa1ea12db99568bc28b","width":320,"height":320}]}},"id":"-3KGbRgazIQM4uWdup2OmiH7Tk7HcemSiva247U8wUA"}],"enabled":true},"thumbnail":"https://b.thumbs.redditmedia.com/LFDHMhCqyo2UUfYSDo5C0u-HmJmzyhOGgg6ZENh2J1I.jpg","subreddit_id":"t5_3410y","edited":false,"link_flair_css_class":null,"author_flair_css_class":null,"gilded":0,"downs":0,"brand_safe":true,"archived":false,"removal_reason":null,"post_hint":"link","can_gild":false,"thumbnail_height":140,"hide_score":false,"spoiler":false,"permalink":"/r/GifRecipes/comments/6anl3c/chorizo_gnocchi_traybake/","num_reports":null,"locked":false,"stickied":false,"created":1494571625,"url":"https://i.imgur.com/wejytsk.gifv","author_flair_text":null,"quarantine":false,"title":"Chorizo Gnocchi Traybake","created_utc":1494542825,"distinguished":null,"media":null,"num_comments":120,"is_self":false,"visited":false,"subreddit_type":"public","ups":1845}}"""
        JsonParser().parse(string)
    }

    val invalidJson by lazy {
        val string = """[]"""
        JsonParser().parse(string)
    }

    @Test fun deserializeSelfPost() {
        val deserializer = RedditResponseItemDeserializer()
        val listingItem = deserializer.deserialize(selfPost, null, null)
        Assert.assertEquals(listingItem.type, "t3")
        Assert.assertEquals(listingItem.id, "5s58rb")
        Assert.assertEquals(listingItem.url, "https://www.reddit.com/r/GifRecipes/comments/5s58rb/community_guidelines/")
        Assert.assertEquals(listingItem.thumbnail, "self")
        Assert.assertEquals(listingItem.domain, "self.GifRecipes")
        Assert.assertEquals(listingItem.previewUrl, null)
    }

    @Test fun deserializeGfycatPost() {
        val deserializer = RedditResponseItemDeserializer()
        val listingItem = deserializer.deserialize(gfycatPost, null, null)
        Assert.assertEquals(listingItem.type, "t3")
        Assert.assertEquals(listingItem.id, "6bcgyo")
        Assert.assertEquals(listingItem.domain, "gfycat.com")
        Assert.assertEquals(listingItem.previewUrl, "https://g.redditmedia.com/DnvLecFKLCPMnGIxDSGW7CxQofeNB7vCOHGVjqoMk6U.gif?s=1b75201be0223b38cfe475bb8df43056")
        Assert.assertEquals(listingItem.thumbnail, "https://a.thumbs.redditmedia.com/3TS4j9FsQWYtl7IKy85BjbMHHFtA366udPOOLUxumK8.jpg")
    }

    @Test fun deserializeImgurPost() {
        val deserializer = RedditResponseItemDeserializer()
        val listingItem = deserializer.deserialize(imgurPost, null, null)
        Assert.assertEquals(listingItem.type, "t3")
        Assert.assertEquals(listingItem.id, "6anl3c")
        Assert.assertTrue(listingItem.domain.contains("imgur"))
        Assert.assertEquals(listingItem.previewUrl, "https://g.redditmedia.com/yko0qOonNg9fnro4tGdCltOQR63ZRz6AYQeNXJj-8l0.gif?s=628cc5c99d5ebc429f59c9e3496cc15c")
        Assert.assertEquals(listingItem.thumbnail, "https://b.thumbs.redditmedia.com/LFDHMhCqyo2UUfYSDo5C0u-HmJmzyhOGgg6ZENh2J1I.jpg")
    }

    @Test(expected = IllegalStateException::class)
    fun deserializeError() {
        val deserializer = RedditResponseItemDeserializer()
        val listingItem = deserializer.deserialize(invalidJson, null, null)
        Assert.fail("Should have thrown a json parse exception!")
    }

}